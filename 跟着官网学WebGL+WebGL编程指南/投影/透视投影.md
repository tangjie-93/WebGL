## 三维透视矩阵的推导
正射投影看到的物体都是按照近大远小的规则来呈现的。跟模型距离观察者的距离有直接的关系。
这种近大远小的效果就赋予了模型深度感，或者称之为**透视感**。

**透视投影，可视范围是一个棱锥体盒子，下面是透视投影的可视范围的示意图。**
<img src='../../images/透视投影.awebp'>


接下来我们将推导一下**透视投影**的矩阵是如何得到的。

假设模型中有一个点`p(x,y,z)`表示像素坐标,投影到近平面后的坐标为`p‘(x',y',z')`，表示投影坐标。

那么 `p`和`p'`之间的关系是怎样的呢？首先我们的已知条件是.
+ `x` 坐标在 `[-width/2, width / 2]` 之间。
+ `y`坐标在`[-height/2， height/2]` 之间。
+  `z`坐标在`[zNear，zFar]`之间。

投影后的点 `p'（x',y',z'）`，其中：

+ `x'` 在 `[-1，1]` 之间
+ `y'` 在 `[-1，1]`之间
+ `z'` 在 `[-1，1]` 之间

根据上面的透视投影的示意图，我们根据相似三角形原理，可以得到如下公式。
```js
zNear/z = y1/y = x1/x  
```
根据上面的等式，可以得到下面的等式
```
x1 = zNear*x/z
y1 = zNear*y/z
```
其中 `x1`和`y1` 是相机坐标系下的坐标(非裁剪坐标系下的坐标)经过视线看向物体后在近平面上的交点坐标。，所以我们还需要将 `x1`和`y1`变换到 `[-1，1]` 之间。
```js
x' = x1/(width/2) = (2*zNear*x)/(z*width)
y' = y1/(height/2) = (2*zNear*y)/(z*height)
```

从上面的表达式我们可以发现，`x'` 和 `y'` 不仅和投影面的宽度(`width`)和高度(`height`)有关系，还和 `z` 轴坐标有关系。
`z` 轴坐标越大，`x'` 和 `y'` 越小，也就产生了近大远小的效果，如果我们将齐次坐标 `w `分量设置为 `z`，此时 `x'` 和 `y'` 的值为。


最终我们得到的透视投影矩阵如下所示。



未完待续。




